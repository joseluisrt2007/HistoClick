<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Exploradores del Virreinato</title>

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Cinzel:wght@400;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="juego-estilo.css" />
</head>
<body>
  <div class="game-welcome">
    <h1>Â¡Exploradores del Virreinato!</h1>
    <p>EmbÃ¡rcate en una aventura histÃ³rica para descubrir los secretos del Virreinato de la Nueva EspaÃ±a. Â¡Responde las preguntas!</p>
    <button class="game-button" onclick="startGame()">Â¡Emprende la Aventura!</button>
  </div>

  <header>
    <button class="back-button" onclick="goBack()" aria-label="Regresar">âŸµ</button>
    <div class="header-title">Exploradores del Virreinato</div>
    <button class="reales-button" onclick="window.location.href='reales.html'" aria-label="Ver Reales">ðŸ’°</button>
  </header>

  <div class="map-container">
    <div class="card" data-index="0">
      <div class="question-container">
        <span id="level-0"></span>
        <p id="question-text-0"></p>
        <div id="options-0"></div>
        <p id="feedback-0"></p>
      </div>
    </div>
    <div class="card" data-index="1">
      <div class="question-container">
        <span id="level-1"></span>
        <p id="question-text-1"></p>
        <div id="options-1"></div>
        <p id="feedback-1"></p>
      </div>
    </div>
    <div class="card" data-index="2">
      <div class="question-container">
        <span id="level-2"></span>
        <p id="question-text-2"></p>
        <div id="options-2"></div>
        <p id="feedback-2"></p>
      </div>
    </div>
    <div class="card" data-index="3">
      <div class="question-container">
        <span id="level-3"></span>
        <p id="question-text-3"></p>
        <div id="options-3"></div>
        <p id="feedback-3"></p>
      </div>
    </div>
    <div class="card" data-index="4">
      <div class="question-container">
        <span id="level-4"></span>
        <p id="question-text-4"></p>
        <div id="options-4"></div>
        <p id="feedback-4"></p>
      </div>
    </div>
    <div class="card" data-index="5">
      <div class="question-container">
        <span id="level-5"></span>
        <p id="question-text-5"></p>
        <div id="options-5"></div>
        <p id="feedback-5"></p>
      </div>
    </div>
    <div class="card" data-index="6">
      <div class="question-container">
        <span id="level-6"></span>
        <p id="question-text-6"></p>
        <div id="options-6"></div>
        <p id="feedback-6"></p>
      </div>
    </div>
    <div class="card" data-index="7">
      <div class="question-container">
        <span id="level-7"></span>
        <p id="question-text-7"></p>
        <div id="options-7"></div>
        <p id="feedback-7"></p>
      </div>
    </div>
    <div class="card" data-index="8">
      <div class="question-container">
        <span id="level-8"></span>
        <p id="question-text-8"></p>
        <div id="options-8"></div>
        <p id="feedback-8"></p>
      </div>
    </div>
  </div>

  <script>
    let cards = [...document.querySelectorAll('.card')];
    let current = 0;
    let realCount = parseInt(localStorage.getItem('realCount') || '0');

    const questions = [
      {
        question: "Â¿En quÃ© aÃ±o se creÃ³ el Virreinato de la Nueva EspaÃ±a?",
        options: ["1492", "1535", "1600", "1700"],
        correct: 1,
        feedback: "Â¡Correcto! El Virreinato se creÃ³ en 1535 tras la conquista de Tenochtitlan."
      },
      {
        question: "Â¿QuiÃ©n era el representante directo del rey de EspaÃ±a en el Virreinato?",
        options: ["El obispo", "El virrey", "El encomendero", "El misionero"],
        correct: 1,
        feedback: "Â¡Correcto! El virrey gobernaba en nombre del rey de EspaÃ±a."
      },
      {
        question: "Â¿CuÃ¡l fue la principal fuente de riqueza del Virreinato?",
        options: ["Comercio de especias", "MinerÃ­a de plata", "Pesca", "Textiles"],
        correct: 1,
        feedback: "Â¡Correcto! La minerÃ­a de plata fue la principal fuente de riqueza."
      },
      {
        question: "El sistema de encomiendas permitÃ­a a los espaÃ±oles recibir tributo y trabajo indÃ­gena.",
        options: ["Verdadero", "Falso"],
        correct: 0,
        feedback: "Â¡Correcto! Las encomiendas otorgaban tributo y trabajo indÃ­gena a los espaÃ±oles."
      },
      {
        question: "Â¿QuÃ© Ã³rdenes religiosas fueron clave en la evangelizaciÃ³n?",
        options: ["Franciscanos, dominicos y jesuitas", "Templarios y carmelitas", "Benedictinos y agustinos", "Ninguna de las anteriores"],
        correct: 0,
        feedback: "Â¡Correcto! Los franciscanos, dominicos y jesuitas lideraron la evangelizaciÃ³n."
      },
      {
        question: "Los criollos eran espaÃ±oles nacidos en AmÃ©rica.",
        options: ["Verdadero", "Falso"],
        correct: 0,
        feedback: "Â¡Correcto! Los criollos eran hijos de espaÃ±oles nacidos en AmÃ©rica."
      },
      {
        question: "Â¿QuÃ© ciudad fue la capital polÃ­tica y econÃ³mica del Virreinato?",
        options: ["Veracruz", "Acapulco", "Ciudad de MÃ©xico", "Guadalajara"],
        correct: 2,
        feedback: "Â¡Correcto! Ciudad de MÃ©xico fue la capital, construida sobre Tenochtitlan."
      },
      {
        question: "Â¿QuÃ© puertos fueron clave en la ruta comercial del Virreinato?",
        options: ["Veracruz y Acapulco", "Havana y Cartagena", "Lima y Buenos Aires", "Sevilla y CÃ¡diz"],
        correct: 0,
        feedback: "Â¡Correcto! Veracruz y Acapulco conectaban AmÃ©rica con EspaÃ±a y Asia."
      },
      {
        question: "Â¿QuÃ© instituciÃ³n educativa importante se fundÃ³ en el Virreinato?",
        options: ["Universidad de Harvard", "Universidad de MÃ©xico", "Universidad de Lima", "Universidad de Salamanca"],
        correct: 1,
        feedback: "Â¡Correcto! La Universidad de MÃ©xico fue una instituciÃ³n clave."
      }
    ];

    // FunciÃ³n para mezclar el array de preguntas
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function startGame() {
      console.log('Iniciando juego.');
      shuffleArray(questions); // Mezclar preguntas al iniciar
      document.querySelector('.game-welcome').style.display = 'none';
      document.querySelector('.map-container').style.display = 'flex';
      updateCard();
      showQuestion();
    }

    function updateCard() {
      cards.forEach((card, index) => {
        card.classList.toggle('active', index === current);
      });
    }

    function showQuestion() {
      if (current >= questions.length) {
        document.querySelector('.map-container').innerHTML = `
          <div class="final-message">
            <h2>Â¡Maestro Explorador del Virreinato!</h2>
            <p>Has conquistado todos los niveles.</p>
            <button class="game-button" onclick="window.location.href='antecedentes-virreinato.html'">Volver al Inicio</button>
          </div>
        `;
        return;
      }
      document.querySelector(`#level-${current}`).textContent = `Nivel: ${current + 1}/9`;
      const currentQuestion = questions[current];
      const questionText = document.querySelector(`#question-text-${current}`);
      const optionsContainer = document.querySelector(`#options-${current}`);
      const feedbackText = document.querySelector(`#feedback-${current}`);

      questionText.textContent = currentQuestion.question;
      optionsContainer.innerHTML = currentQuestion.options
        .map((option, index) => `<button class="option-button" data-index="${index}">${option}</button>`).join('');
      feedbackText.textContent = '';

      const optionButtons = optionsContainer.querySelectorAll('.option-button');
      optionButtons.forEach(button => {
        button.onclick = () => checkAnswer(parseInt(button.getAttribute('data-index')));
      });
    }

    function checkAnswer(selected) {
      const currentQuestion = questions[current];
      const optionButtons = document.querySelectorAll(`#options-${current} .option-button`);
      const feedbackText = document.querySelector(`#feedback-${current}`);
      optionButtons.forEach(button => button.disabled = true);

      if (selected === currentQuestion.correct) {
        realCount++;
        localStorage.setItem('realCount', realCount);
        feedbackText.textContent = "Â¡Correcto! +1 Real.";
        console.log('Respuesta correcta. Nivel:', current + 1, 'Reales:', realCount);
        current++;
        setTimeout(() => {
          updateCard();
          showQuestion();
        }, 1000);
      } else {
        feedbackText.textContent = "Â¡Casi! Intenta de nuevo.";
        optionButtons.forEach(button => button.disabled = false);
      }
    }

    function restartGame() {
      console.log('Reiniciando juego.');
      current = 0;
      cards.forEach((card, index) => {
        card.querySelector(`#question-text-${index}`).textContent = '';
        card.querySelector(`#options-${index}`).innerHTML = '';
        card.querySelector(`#feedback-${index}`).textContent = '';
        card.querySelector(`#level-${index}`).textContent = '';
        card.classList.remove('active');
      });
      document.querySelector('.map-container').style.display = 'flex';
      updateCard();
      showQuestion();
    }

    let startY = 0;
    let endY = 0;

    const mapContainer = document.querySelector('.map-container');

    mapContainer.addEventListener('touchstart', (e) => {
      startY = e.touches[0].clientY;
    }, false);

    mapContainer.addEventListener('touchend', (e) => {
      endY = e.changedTouches[0].clientY;
      handleGesture();
    }, false);

    function handleGesture() {
      const diffY = endY - startY;
      if (Math.abs(diffY) > 50) {
        if (diffY > 0 && current > 0) {
          current--;
          updateCard();
          showQuestion();
        } else if (diffY < 0 && current < questions.length - 1) {
          current++;
          updateCard();
          showQuestion();
        }
      }
    }

    // FunciÃ³n para manejar el regreso
    function goBack() {
      if (window.history.length > 1) {
        history.back();
      } else {
        window.location.href = 'antecedentes-virreinato.html'; // PÃ¡gina por defecto si no hay historial
      }
    }

    updateCard();
  </script>
</body>
</html>